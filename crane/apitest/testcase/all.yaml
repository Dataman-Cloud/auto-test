# Test using included Django test app
# First install python-django
# Then launch the app in another terminal by doing
#   cd testapp
#   python manage.py testserver test_data.json
# Once launched, tests can be executed via:
# 	python resttest.py http://localhost:8000 miniapp-test.yaml

---
- config:
    - testset: "Tests using test app"
    - variable_binds: {Email: 'admin@admin.com', Password: "adminadmin"}

- test: # 正常测试登录获取token
    - name: "Normal login"
    - url: "/account/v1/login"
    - method: "post"
    - body: {template: '{"Email": "$Email","Password": "$Password"}'}
    - headers: {Content-Type: application/json}
    - expected_status: [200]
    - validators:
        - compare: {jmespath: "code", comparator: "eq", expected: 0}
        - compare: {jmespath: "data", comparator: "length_eq", expected: 32}
    - extract_binds:
        - 'token': {'jmespath': 'data'}

- test: # 异常测试，输入错误帐号密码，登录获取token
    - name: "Abnormal login"
    - url: "/account/v1/login"
    - method: "post"
    - body: {template: '{"Email": "Email","Password": "Password"}'}
    - headers: {Content-Type: application/json}
    - expected_status: [401]
    - validators:
        - compare: {jmespath: "code", comparator: "eq", expected: 10001}
        - compare: {jmespath: "message", comparator: "contains", expected: "account login failed"}

